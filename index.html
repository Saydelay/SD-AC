from flask import Flask, request, jsonify
import json

app = Flask(__name__)
CODES_DATEI = 'codes.json'

@app.route('/api/codes', methods=['POST'])
def codes_hinzufuegen():
    data = request.json
    neuer_code = data.get('code', '').strip().lower()
    if not neuer_code:
        return jsonify({"error": "Kein Code Ã¼bermittelt"}), 400

    try:
        with open(CODES_DATEI, 'r') as f:
            codes = json.load(f)
    except (FileNotFoundError, json.JSONDecodeError):
        codes = []

    if neuer_code not in codes:
        codes.append(neuer_code)
        with open(CODES_DATEI, 'w') as f:
            json.dump(codes, f)

    return jsonify({"message": "Code gespeichert", "code": neuer_code})

if __name__ == '__main__':
    app.run(port=5000)
